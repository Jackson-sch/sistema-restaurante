"use server"\n\nimport { prisma } from "@/lib/prisma"\nimport { variantSchema, modifierGroupSchema, modifierSchema, type VariantInput, type ModifierGroupInput, type ModifierInput } from "@/lib/schemas/menu"\nimport { revalidatePath } from "next/cache"\n\nexport async function getProductOptions(productId: string) { \n  try { \n    const product = await prisma.product.findUnique({ \n      where: { id: productId }, \n      include: { \n        variants: { orderBy: { price: 'asc' } }, \n        modifierGroups: { \n          include: { \n            modifierGroup: { \n              include: { modifiers: { orderBy: { price: 'asc' } } }\n }\n }, \n          orderBy: { order: 'asc' }\n }\n }\n }) \n    if (!product) return { success: false, error: "Producto no encontrado" }\n    return { \n      success: true, \n      data: { \n        variants: product.variants.map(v => ({ ...v, price: Number(v.price) })), \n        modifierGroups: product.modifierGroups.map(pmg => ({ \n          ...pmg.modifierGroup, \n          modifiers: pmg.modifierGroup.modifiers.map(m => ({ ...m, price: Number(m.price) })) \n })) \n }\n }\n } catch (error) { \n    return { success: false, error: "Error al obtener opciones" }\n } \n } \n\n// --- Variants ---\n\nexport async function createVariant(data: VariantInput) {\n  try {\n    const validated = variantSchema.parse(data)\n    const variant = await prisma.productVariant.create({ data: validated })\n    revalidatePath("/dashboard/menu/dishes")\n    return { success: true, data: { ...variant, price: Number(variant.price) } }\n  } catch (error) {\n    return { success: false, error: "Error al crear variante" }\n  }\n}\n\nexport async function updateVariant(id: string, data: Partial<VariantInput>) {\n  try {\n    const validated = variantSchema.partial().parse(data)\n    const variant = await prisma.productVariant.update({ where: { id }, data: validated })\n    revalidatePath("/dashboard/menu/dishes")\n    return { success: true, data: { ...variant, price: Number(variant.price) } }\n  } catch (error) {\n    return { success: false, error: "Error al actualizar variante" }\n  }\n}\n\nexport async function deleteVariant(id: string) {\n  try {\n    await prisma.productVariant.delete({ where: { id } })\n    revalidatePath("/dashboard/menu/dishes")\n    return { success: true }\n  } catch (error) {\n    return { success: false, error: "Error al eliminar variante" }\n  }\n}\n\n// --- Modifier Groups ---\n\nexport async function createModifierGroup(productId: string, data: ModifierGroupInput) {\n  try {\n    const validated = modifierGroupSchema.parse(data)\n    const group = await prisma.modifierGroup.create({ data: validated })\n    await prisma.productModifierGroup.create({ data: { productId, modifierGroupId: group.id } })\n    revalidatePath("/dashboard/menu/dishes")\n    return { success: true, data: { ...group, modifiers: [] } }\n  } catch (error) {\n    return { success: false, error: "Error al crear grupo de modificadores" }\n  }\n}\n\nexport async function updateModifierGroup(id: string, data: Partial<ModifierGroupInput>) {\n  try {\n    const validated = modifierGroupSchema.partial().parse(data)\n    const group = await prisma.modifierGroup.update({\n      where: { id },\n      data: validated,\n      include: { modifiers: true }\n    })\n    revalidatePath("/dashboard/menu/dishes")\n    return {\n      success: true,\n      data: {\n        ...group,\n        modifiers: group.modifiers.map(m => ({ ...m, price: Number(m.price) }))\n      }\n    }\n  } catch (error) {\n    return { success: false, error: "Error al actualizar grupo" }\n  }\n}\n\nexport async function deleteModifierGroup(productId: string, groupId: string) {\n  try {\n    await prisma.productModifierGroup.delete({\n      where: { productId_modifierGroupId: { productId, modifierGroupId: groupId } }\n    })\n    revalidatePath("/dashboard/menu/dishes")\n    return { success: true }\n  } catch (error) {\n    return { success: false, error: "Error al eliminar grupo" }\n  }\n}\n\n// --- Modifiers ---\n\nexport async function createModifier(data: ModifierInput) {\n  try {\n    const validated = modifierSchema.parse(data)\n    const modifier = await prisma.modifier.create({ data: validated })\n    revalidatePath("/dashboard/menu/dishes")\n    return { success: true, data: { ...modifier, price: Number(modifier.price) } }\n  } catch (error) {\n    return { success: false, error: "Error al crear modificador" }\n  }\n}\n\nexport async function updateModifier(id: string, data: Partial<ModifierInput>) {\n  try {\n    const validated = modifierSchema.partial().parse(data)\n    const modifier = await prisma.modifier.update({ where: { id }, data: validated })\n    revalidatePath("/dashboard/menu/dishes")\n    return { success: true, data: { ...modifier, price: Number(modifier.price) } }\n  } catch (error) {\n    return { success: false, error: "Error al actualizar modificador" }\n  }\n}\n\nexport async function deleteModifier(id: string) {\n  try {\n    await prisma.modifier.delete({ where: { id } })\n    revalidatePath("/dashboard/menu/dishes")\n    return { success: true }\n  } catch (error) {\n    return { success: false, error: "Error al eliminar modificador" }\n  }\n}\n
